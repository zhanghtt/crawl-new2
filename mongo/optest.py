#!/usr/bin/env python
# -*- coding: utf-8 -*-
from mongo import op
from tqdm import tqdm
import json
from ast import literal_eval
a='[{ "referenceTime": "2020-11-08 17:28:00","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "storage.360buyimg.com/i.imageUpload/6a645f3533626539306234383833643931353132303539343330323331_sma.jpg","userImageUrl": "storage.360buyimg.com/i.imageUpload/6a645f3533626539306234383833643931353132303539343330323331_sma.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "咿呀伊尔呦10","userClient": "2","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "1","anonymousFlag": "0","userLevelName": "PLUS会员","plusAvailable": "201","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#e1a10a","isMobile": True,"userClientShow": "来自京东iPhone客户端"},{ "id": "14921593873","topped": "0","guid": "1dbdcf2fbb53612d30ff0455ede5b154","content": "质量非常好，非常满意，真的很喜欢，发货速度非常快，包装非常仔细、严实，物流态度很好，运送速度很快，很满意的一次购物。","creationTime": "2020-11-17 18:45:08","isTop": False,"referenceId": "100000007131","referenceImage": "jfs/t1/101558/3/4477/179934/5de6fdb9E872eb689/9dfa86e4960978ed.jpg","referenceName": "必品阁（bibigo）鲜菜猪肉王水饺 600g 24只装 饺子 早餐食材","referenceTime": "2020-11-01 21:55:33","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","userImageUrl": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "y***y","userClient": "4","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "0","anonymousFlag": "1","userLevelName": "PLUS会员","plusAvailable": "201","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#e1a10a","isMobile": True,"userClientShow": "来自京东Android客户端"},{ "id": "14921139295","topped": "0","guid": "66e1d62ae339122ca1f908daa751c27f","content": "东西不错，物流迅速，值得推荐","creationTime": "2020-11-17 17:28:30","isTop": False,"referenceId": "100000007131","referenceImage": "jfs/t1/101558/3/4477/179934/5de6fdb9E872eb689/9dfa86e4960978ed.jpg","referenceName": "必品阁（bibigo）鲜菜猪肉王水饺 600g 24只装 饺子 早餐食材","referenceTime": "2020-11-01 23:54:32","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "storage.360buyimg.com/i.imageUpload/ccecbad3c1f7d4c631343234393339313136373634_sma.jpg","userImageUrl": "storage.360buyimg.com/i.imageUpload/ccecbad3c1f7d4c631343234393339313136373634_sma.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "天***云","userClient": "4","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "1","anonymousFlag": "0","userLevelName": "PLUS会员","plusAvailable": "201","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#e1a10a","isMobile": True,"userClientShow": "来自京东Android客户端"},{ "id": "14920964046","topped": "0","guid": "d90edaf0fcc5b16fcae3df142e40b612","content": "味美价廉，京东自营值得信赖\x26hellip\x3B\x26hellip\x3B","creationTime": "2020-11-17 17:00:23","isTop": False,"referenceId": "100000007131","referenceImage": "jfs/t1/101558/3/4477/179934/5de6fdb9E872eb689/9dfa86e4960978ed.jpg","referenceName": "必品阁（bibigo）鲜菜猪肉王水饺 600g 24只装 饺子 早餐食材","referenceTime": "2020-10-24 18:28:27","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","userImageUrl": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "阿瑞锦HK","userClient": "2","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "0","anonymousFlag": "0","userLevelName": "PLUS会员","plusAvailable": "201","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#e1a10a","isMobile": True,"userClientShow": "来自京东iPhone客户端"},{ "id": "14920923867","topped": "0","guid": "c60ca1d388a4700671546739e6275330","content": "必品阁这几种口味的水饺我几乎都买遍了！玉米猪肉馅香甜扎实，饺子皮柔韧嫩滑～个个大只饱满，可蒸可煮，都好吃！好煮饱腹口味好！京东每次派大额生鲜券我都买上几包做应急口粮～包装好，日期新，送到时冻得很好没化冻，新鲜！","creationTime": "2020-11-17 16:52:41","isTop": False,"referenceId": "100000007131","referenceImage": "jfs/t1/101558/3/4477/179934/5de6fdb9E872eb689/9dfa86e4960978ed.jpg","referenceName": "必品阁（bibigo）鲜菜猪肉王水饺 600g 24只装 饺子 早餐食材","referenceTime": "2020-11-11 01:52:28","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "storage.360buyimg.com/i.imageUpload/6469776f68616f6c6531343132333837343337363734_sma.jpg","userImageUrl": "storage.360buyimg.com/i.imageUpload/6469776f68616f6c6531343132333837343337363734_sma.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "-日久","userClient": "4","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "1","anonymousFlag": "0","userLevelName": "PLUS会员","plusAvailable": "201","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#e1a10a","isMobile": True,"userClientShow": "来自京东Android客户端"},{ "id": "14920849157","topped": "0","guid": "af35c0a46b18c50c21d22dce86d547e0","content": "水饺不错，还会再买！","creationTime": "2020-11-17 16:39:58","isTop": False,"referenceId": "100000007131","referenceImage": "jfs/t1/101558/3/4477/179934/5de6fdb9E872eb689/9dfa86e4960978ed.jpg","referenceName": "必品阁（bibigo）鲜菜猪肉王水饺 600g 24只装 饺子 早餐食材","referenceTime": "2020-09-24 09:03:24","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","userImageUrl": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "N***T","userClient": "2","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "0","anonymousFlag": "1","userLevelName": "银牌会员","plusAvailable": "203","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#666666","isMobile": True,"userClientShow": "来自京东iPhone客户端"},{ "id": "14920771557","topped": "0","guid": "39985bf6f5e1cfaf45c8084bf688613c","content": "品质还可以，经常会回购。","creationTime": "2020-11-17 16:27:43","isTop": False,"referenceId": "100000007131","referenceImage": "jfs/t1/101558/3/4477/179934/5de6fdb9E872eb689/9dfa86e4960978ed.jpg","referenceName": "必品阁（bibigo）鲜菜猪肉王水饺 600g 24只装 饺子 早餐食材","referenceTime": "2020-11-11 23:59:49","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","userImageUrl": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "小***兔","userClient": "4","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "0","anonymousFlag": "1","userLevelName": "PLUS会员","plusAvailable": "201","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#e1a10a","isMobile": True,"userClientShow": "来自京东Android客户端"},{ "id": "14920714019","topped": "0","guid": "ffbe6422ccafd1c33d52c56de35c1874","content": "饺子挺大的，皮薄馅多，挺好吃的","creationTime": "2020-11-17 16:18:36","isTop": False,"referenceId": "100000007131","referenceImage": "jfs/t1/101558/3/4477/179934/5de6fdb9E872eb689/9dfa86e4960978ed.jpg","referenceName": "必品阁（bibigo）鲜菜猪肉王水饺 600g 24只装 饺子 早餐食材","referenceTime": "2020-09-24 10:37:30","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","userImageUrl": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "jd_雨润风和","userClient": "0","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "0","anonymousFlag": "0","userLevelName": "银牌会员","plusAvailable": "103","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#666666","isMobile": False,"userClientShow": ""},{ "id": "14920651470","topped": "0","guid": "7b7cece8df06cbe60a789b9d539404d5","content": "味道不错，多次购买好评","creationTime": "2020-11-17 16:07:42","isTop": False,"referenceId": "100000007131","referenceImage": "jfs/t1/101558/3/4477/179934/5de6fdb9E872eb689/9dfa86e4960978ed.jpg","referenceName": "必品阁（bibigo）鲜菜猪肉王水饺 600g 24只装 饺子 早餐食材","referenceTime": "2020-10-16 12:33:20","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","userImageUrl": "misc.360buyimg.com/user/myjd-2015/css/i/peisong.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "f***d","userClient": "0","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "0","anonymousFlag": "1","userLevelName": "PLUS会员","plusAvailable": "201","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#e1a10a","isMobile": False,"userClientShow": ""},{ "id": "14920582890","topped": "0","guid": "03235237bc11ca385ddf016f83e35893","content": "还不错","creationTime": "2020-11-17 15:57:08","isTop": False,"referenceId": "100000007131","referenceImage": "jfs/t1/101558/3/4477/179934/5de6fdb9E872eb689/9dfa86e4960978ed.jpg","referenceName": "必品阁（bibigo）鲜菜猪肉王水饺 600g 24只装 饺子 早餐食材","referenceTime": "2020-09-24 09:16:16","referenceType": "Product","referenceTypeId": "0","firstCategory": "12218","secondCategory": "13591","thirdCategory": "13592","replyCount": "0","replyCount2": "0","score": "5","status": "1","title": "","usefulVoteCount": "0","uselessVoteCount": "0","userImage": "storage.360buyimg.com/i.imageUpload/31333936313739363831335f7031353732393939323037333831_sma.jpg","userImageUrl": "storage.360buyimg.com/i.imageUpload/31333936313739363831335f7031353732393939323037333831_sma.jpg","viewCount": "0","orderId": "0","isReplyGrade": False,"uid": "0","nickname": "jd_天天天蓝","userClient": "4","images":[],"videos":[],"showOrderComment":{"id": "","guid": "","content": "","creationTime": "","isTop": "","referenceId": "","referenceType": "","referenceTypeId": "","firstCategory": "","secondCategory": "","thirdCategory": "","replyCount": "","replyCount2": "","score": "","status": "","usefulVoteCount": "","uselessVoteCount": "","viewCount": "","orderId": "","isReplyGrade": "","uid": "","userClient": "","isDeal": "","integral": "","userImgFlag": "","anonymousFlag": "","mobileVersion": "","recommend": "","userLevelColor": "","userClientShow": ""},"mergeOrderStatus": "","discussionId": "","productColor": "鲜菜猪肉王水饺 600g","productSize": "","imageCount": "","integral": "0","userImgFlag": "1","anonymousFlag": "0","userLevelName": "PLUS会员","plusAvailable": "201","productSales":[],"mobileVersion": "","recommend": "False","userLevelColor": "#e1a10a","isMobile": True,"userClientShow": "来自京东Android客户端"}]'
print(a[5600:])
print(literal_eval(a))

with op.DBManger() as m:
    # 创建临时表本月任务的分界线
    skuid_set = set()
    pipeline = [
        {
            "$project": {
                "app_id": "$app_id",
            }
        },
    ]
    for item in m.read_from_yield(db_collect=("jicheng", "autopkgcatpure"), out_field=("app_id",), pipeline=pipeline):
        pass


import wda
w = wda.Client("")
s = w.session()
s.close()